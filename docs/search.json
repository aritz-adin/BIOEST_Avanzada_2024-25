[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Bioestadística Avanzada / Curso 2024-25",
    "section": "",
    "text": "Linear Mixed Models\nGeneralized Linear Mixed Models"
  },
  {
    "objectID": "index.html#exercises",
    "href": "index.html#exercises",
    "title": "Bioestadística Avanzada / Curso 2024-25",
    "section": "",
    "text": "Linear Mixed Models\nGeneralized Linear Mixed Models"
  },
  {
    "objectID": "index.html#references",
    "href": "index.html#references",
    "title": "Bioestadística Avanzada / Curso 2024-25",
    "section": "References",
    "text": "References\nDurban, M. (2014). Introducción a los Modelos Mixtos. Departamento de Estadística, UC3M.\nGallagher, J. (2023). Introduction to Generalised Linear Mixed Models using R. Statistical Services Centre Ltd.\nPinheiro, J.C., and Bates, D.M. (2000). Mixed-effects Models in S and S-PLUS. Springer Science & Business Media.\nZuur, A.F., Hilbe, J.M., and Ieno, E.N. (2013). A Beginner’s Guide to GLM and GLMM with R. Highland Statistics Ltd."
  },
  {
    "objectID": "Chapter1_Exercises.html",
    "href": "Chapter1_Exercises.html",
    "title": "Chapter 1: Linear Mixed Models",
    "section": "",
    "text": "Exercise 1: plasma data\nBelow are the results of a randomised complete block experiment to compare the effects on the clotting time of plasma (mins) of four different methods for the treatment of plasma (material extracted from Gallagher, 2023). Samples of plasma were taken from a random sample of 8 volunteers and were subjected to all 4 treatments.\n\n\n\n\nTreatment\n\n\n\n\n\n\n\nVolunteer\n1\n2\n3\n4\n\n\n1\n8.4\n9.4\n9.8\n12.2\n\n\n2\n12.8\n15.2\n12.9\n14.4\n\n\n3\n9.6\n9.1\n11.2\n9.8\n\n\n4\n9.8\n8.8\n9.9\n12.0\n\n\n5\n8.4\n8.2\n8.5\n8.5\n\n\n6\n8.6\n9.9\n9.8\n10.9\n\n\n7\n8.9\n9.0\n9.2\n10.4\n\n\n8\n7.9\n8.1\n8.2\n10.0\n\n\n\n\n1. Load the data intored in the Plasma.txt file, convert Volunteer and Treatment variables to factor, and make a descriptive plot to visualize differences between treatments and/or subjects.\n\nPlasma &lt;- read.table(\"Plasma.txt\", header=TRUE)\nhead(Plasma, n=8)\n\n  Volunteer Treatment Clotting\n1         1         1      8.4\n2         1         2      9.4\n3         1         3      9.8\n4         1         4     12.2\n5         2         1     12.8\n6         2         2     15.2\n7         2         3     12.9\n8         2         4     14.4\n\nPlasma$Volunteer &lt;- as.factor(Plasma$Volunteer)\nPlasma$Treatment &lt;- as.factor(Plasma$Treatment)\nstr(Plasma)\n\n'data.frame':   32 obs. of  3 variables:\n $ Volunteer: Factor w/ 8 levels \"1\",\"2\",\"3\",\"4\",..: 1 1 1 1 2 2 2 2 3 3 ...\n $ Treatment: Factor w/ 4 levels \"1\",\"2\",\"3\",\"4\": 1 2 3 4 1 2 3 4 1 2 ...\n $ Clotting : num  8.4 9.4 9.8 12.2 12.8 15.2 12.9 14.4 9.6 9.1 ...\n\n\nWe can make a descriptive plot of the data using the ggplot2 package\n\nlibrary(ggplot2)\n\nggplot(Plasma, aes(x=Clotting, y=Volunteer, color=Treatment)) +\n  geom_point() +\n  labs(x=\"Clotting time (mins)\", y=\"Volunteer\") +\n  theme_minimal()\n\n\n\n\nWe observe systematic differences between subjects and treatments.\n\n\n2. Which variable should be included as a fixed effect, and which as a random effect? Make a design plot to visually compare the magnitude of the effects of the Treatment and Volunteer factors.\n\nWe want to compare these particular types of treatments (experimental factor), so we use fixed effects for the Treatment factor.\nThe eight subjects represents a sample from the population about which we wish to make inferences (random factor), so we use random effects to model the Volunteer factor.\n\n\nplot.design(Clotting ~ Treatment + Volunteer, data=Plasma)\n\n\n\n\nAverage clotting time for each level of the factors Treatment and Volunteer\n\n\n\n\n\nWe see that the variability associated with the Treatment factor is lower than the variability associated with the Volunteer factor.\nWe also see that the average clotting time according to the treatment type is in the order \\(T1 \\leq T2 \\leq T3 \\leq T4\\).\n\n\n\n3. Write the linear mixed model equation.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n4. Test if random effects are necessary.\n\n\n5. Check if the treatment effect is significant.\n\n\n\n\n6. Verify whether the model assumptions are satisfied.\na) Assessing assumptions on the within-group errors\n\nb) Assessing assumptions on the random-effects\n\n\n\n7. Examine the model results (estimated fixed effects and variance components). Compute and interpret the intra-class correlation coefficient. Compute the predicted random effects and fitted values.\na) Estimated fixed effects and 95% confidence intervals\n\n\n\nb) Estimated variance components and 95% confidence intervals\n\nc) Compute the predicted random effects and fitted values\n\n\n\nExercise 2: spider data\nOxbrough et al. (2005) investigated how spider communities change over forestation cycles in conifer and broadleaf plantations. They identified environmental and structural features of the habitat than can be used as indicators of spider biodiversity. Different plots were surveyed, each comprising 5 to 7 sampling sites separated by a minimum of 50 metres. More than 100 species of spiders were observed.\nThe Spiders.txt file contains some of the data recorded from the original study (material extracted from Zuur et al., 2013). We are interested in analyzing the relationship between the spider diversity in each site with some environmental explanatory variables. The data set contains the following variables:\n\nDivIndex: Variable of interest. Lower values of this index indicates less abundance of different species.\nHerbLayer: Percentage of Herb Layer Cover\nLitter: Percentage of Litter Content\nGroundVeg: Percentage of Ground Vegetation\nPlot: Factor indicating the surveyed plot.\n\n\n1. Load the data intored in the Spiders.txt file and convert Plot variable to factor. Make descriptive graphs to visualize relationships between the variable of interest and the explanatory variables, taking into account the Plot factor.\n\nSpiders &lt;- read.table(\"Spiders.txt\", header=T)\nSpiders$Plot &lt;- as.factor(Spiders$Plot)\nstr(Spiders)\n\n'data.frame':   168 obs. of  5 variables:\n $ DivIndex : num  1.05 1.13 1 0.87 0.94 1.01 1.2 0.38 0.71 0.82 ...\n $ HerbLayer: num  0.27 0.45 0.63 0.49 0.32 0.73 0.68 0.2 0.39 0.38 ...\n $ GroundVeg: num  0.01 0.01 0.01 0.01 0.03 0.27 0.15 0.15 0.59 0.35 ...\n $ Litter   : num  0 0 0 0 0 0 0 0.63 0.06 0.49 ...\n $ Plot     : Factor w/ 30 levels \"1\",\"2\",\"3\",\"4\",..: 1 1 1 1 1 1 1 2 2 2 ...\n\n\nWe can make descriptive graphs of the data using the ggplot2 package\n\nlibrary(ggplot2)\n\nggplot(Spiders, aes(x=HerbLayer, y=DivIndex, color=Plot)) +\n  geom_point() +\n  labs(x=\"Percentage of Herb Layer Cover\", y=\"Diversity Index\") +\n  theme_minimal()\n\n\n\nggplot(Spiders, aes(x=Litter, y=DivIndex, color=Plot)) +\n  geom_point() +\n  labs(x=\"Percentage of Litter Content\", y=\"Diversity Index\") +\n  theme_minimal()\n\n\n\nggplot(Spiders, aes(x=GroundVeg, y=DivIndex, color=Plot)) +\n  geom_point() +\n  labs(x=\"Percentage of Ground Vegetation\", y=\"Diversity Index\") +\n  theme_minimal()\n\n\n\n\nDesign graph to compare average diversity indexes for each level of the Plot factor\n\nplot.design(DivIndex ~ Plot, data=Spiders)\n\n\n\n\n\n\n2. Test if random effects are necessary\n\n\n3. Check which environmental variables should be included in the model.\nWe compare nested models:\n\nM0 &lt;- lmer(DivIndex ~ 1 + (1|Plot), data=Spiders, REML=FALSE)\nM1 &lt;- lmer(DivIndex ~ 1 + HerbLayer + (1|Plot), data=Spiders, REML=FALSE)\nM2 &lt;- lmer(DivIndex ~ 1 + HerbLayer + Litter + (1|Plot), data=Spiders, REML=FALSE)\nM3 &lt;- lmer(DivIndex ~ 1 + HerbLayer + Litter + GroundVeg + (1|Plot), data=Spiders, REML=FALSE)\nanova(M0,M1,M2,M3)\n\nData: Spiders\nModels:\nM0: DivIndex ~ 1 + (1 | Plot)\nM1: DivIndex ~ 1 + HerbLayer + (1 | Plot)\nM2: DivIndex ~ 1 + HerbLayer + Litter + (1 | Plot)\nM3: DivIndex ~ 1 + HerbLayer + Litter + GroundVeg + (1 | Plot)\n   npar     AIC     BIC  logLik deviance   Chisq Df Pr(&gt;Chisq)    \nM0    3 -186.68 -177.31  96.339  -192.68                          \nM1    4 -198.50 -186.01 103.252  -206.50 13.8261  1  0.0002005 ***\nM2    5 -205.88 -190.26 107.940  -215.88  9.3759  1  0.0021985 ** \nM3    6 -204.26 -185.52 108.132  -216.26  0.3830  1  0.5360224    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\n\n\n\n\n4. Fit the final linear mixed model and write its equation\n\n\n\n\n\n\n\n\n5. Verify whether the model assumptions are satisfied.\na) Assessing assumptions on the within-group errors\nb) Assessing assumptions on the random effects\n\n\n6. Examine the model results (estimated fixed effects and variance components). Compute and interpret the intra-class correlation coefficient. Make a plot of observed vs predicted diversity index values.\na) Estimated fixed effects and 95% confidence intervals\nb) Estimated variance components and 95% confidence intervals\n\nVarCorr(Model)\n\n Groups   Name        Std.Dev.\n Plot     (Intercept) 0.064379\n Residual             0.117703\n\nconfint(Model, parm=\"theta_\")\n\nComputing profile confidence intervals ...\n\n\n            2.5 %     97.5 %\n.sig01 0.03582034 0.09292245\n.sigma 0.10450819 0.13254556\n\n\n\nc) Compare observed and predicted diversity index values\n\n\n\nExercise 3: split-plot experiment on varieties of oats\nThese data have been introduced by Yates (1935) as an example of a split-plot design (material extracted from Durban, 2014). The experimental units were arranged into six block using a \\(3 \\times 4\\) full factorial design, with three varieties of oats and four nitrogen concentrations. The term full factorial means that every variety was used with every nitrogen concentration.\n\nOats &lt;- read.table(\"Oats.txt\", header=T, stringsAsFactors = T)\nhead(Oats, n=12)\n\n   Block     Variety nitro yield\n1      I     Victory   0.0   111\n2      I     Victory   0.2   130\n3      I     Victory   0.4   157\n4      I     Victory   0.6   174\n5      I Golden Rain   0.0   117\n6      I Golden Rain   0.2   114\n7      I Golden Rain   0.4   161\n8      I Golden Rain   0.6   141\n9      I  Marvellous   0.0   105\n10     I  Marvellous   0.2   140\n11     I  Marvellous   0.4   118\n12     I  Marvellous   0.6   156\n\nstr(Oats)\n\n'data.frame':   72 obs. of  4 variables:\n $ Block  : Factor w/ 6 levels \"I\",\"II\",\"III\",..: 1 1 1 1 1 1 1 1 1 1 ...\n $ Variety: Factor w/ 3 levels \"Golden Rain\",..: 3 3 3 3 1 1 1 1 2 2 ...\n $ nitro  : num  0 0.2 0.4 0.6 0 0.2 0.4 0.6 0 0.2 ...\n $ yield  : int  111 130 157 174 117 114 161 141 105 140 ...\n\nlibrary(ggplot2)\n\nggplot(Oats, aes(x=factor(nitro), y=yield, color=Variety)) +\n  geom_line(aes(group=Variety)) + \n  geom_point() + \n  labs(x=\"Nitrogen concentration\", y=\"Yield\") +\n  ggtitle(\"Yield of oats by variety and nitrogen level\") +\n  facet_wrap(~ Block, ncol=2) +\n  theme_minimal()\n\n\n\n\nDesign graph to compare average yields for each level of Block, Variety and nitro factors\n\nplot.design(yield ~ Block*Variety*factor(nitro), data=Oats)\n\n\n\n\n\n1. Test if random effects are necessary\n\n\n\n\n\n2. Choose the correct structure for the fixed effects\n\n\n\n\n3. Fit the final linear mixed model and write its equation\n\n\n\n\n\n\n\n\n\n\n\n4. Verify whether the model assumptions are satisfied.\na) Assessing assumptions on the within-group errors\nb) Assessing assumptions on the random-effects\n\n\n5. Examine the model results.\na) Estimated fixed effects and 95% confidence intervals\nb) Estimated variance components and 95% confidence intervals\n\n\nc) Predicted random effects and yield values"
  },
  {
    "objectID": "Chapter2_Exercises.html",
    "href": "Chapter2_Exercises.html",
    "title": "Chapter 2: Generalized Linear Mixed Models",
    "section": "",
    "text": "Exercise 1\nData from a clinical trial, involving 2 treatments (control and active drug), conducted at 11 randomly selected centres are discussed by Beitler and Landis (1985). For the \\(i\\)-th center and \\(j\\)-th treatment, the proportion of \\(n_{ij}\\) patients having a positive response (\\(y_{ij}\\)) is recorded below (material extracted from Gallagher, 2023):\n\n\n\nCentre\nTreatment\n\\(y_{ij}\\)\n\\(n_{ij}\\)\n\n\n\n\n1\ndrug\n11\n36\n\n\n1\ncontrol\n10\n37\n\n\n2\ndrug\n16\n20\n\n\n2\ncontrol\n22\n32\n\n\n3\ndrug\n14\n19\n\n\n3\ncontrol\n7\n19\n\n\n\\(\\ldots\\)\n\\(\\ldots\\)\n\\(\\ldots\\)\n\\(\\ldots\\)\n\n\n\n\n1. Load the data intored in the multicentre.txt file, convert centre variables to factor, and make a descriptive plot to visualize differences between treatments and/or centers.\n\nmulticentre &lt;- read.table(file=\"multicentre.txt\", header=T, stringsAsFactors=T)\nhead(multicentre)\n\n  centre   treat  y  n       obs\n1      1    drug 11 36 0.3055556\n2      1 control 10 37 0.2702703\n3      2    drug 16 20 0.8000000\n4      2 control 22 32 0.6875000\n5      3    drug 14 19 0.7368421\n6      3 control  7 19 0.3684211\n\nmulticentre$centre &lt;- as.factor(multicentre$centre)\nstr(multicentre)\n\n'data.frame':   22 obs. of  5 variables:\n $ centre: Factor w/ 11 levels \"1\",\"2\",\"3\",\"4\",..: 1 1 2 2 3 3 4 4 5 5 ...\n $ treat : Factor w/ 2 levels \"control\",\"drug\": 2 1 2 1 2 1 2 1 2 1 ...\n $ y     : int  11 10 16 22 14 7 2 1 6 0 ...\n $ n     : int  36 37 20 32 19 19 16 17 17 12 ...\n $ obs   : num  0.306 0.27 0.8 0.688 0.737 ...\n\n\nWe can make a descriptive plot of the data using the ggplot2 package\n\nlibrary(ggplot2)\n\nlibrary(ggplot2)\nggplot(multicentre, aes(x=obs, y=centre, color=treat)) +\n  geom_point() +\n  labs(x=\"Observed probability\", y=\"Centre\")\n\n\n\n\nWe observe systematic differences between centres.\n\n\n2. Which variable should be included as a fixed effect, and which as a random effect? Make a design plot to visually compare the magnitude of the effects of the centre and treat factors.\n\nWe want to compare these particular treatments (experimental factor), so we use fixed effects for the treat factor.\nThe eleven centres represents a random sample from the population about which we wish to make inferences (random factor), so we use random effects to model the center factor.\n\n\nplot.design(obs ~ treat*centre, data=multicentre)\n\n\n\n\nAverage observed probabilities for each level of the factors treat and center\n\n\n\n\n\nWe see that the variability associated with the treatment is much lower than the variability associated with the centres.\nWe also see that the average probability of a positive response is higher in the active drug treatment.\n\n\n\n3. Write the mixed logistic regression model equation.\n\\[y_{ij} | u_i  \\sim Bin(n_{ij},\\pi_{ij}), \\quad i=1,\\ldots,10 \\quad \\mbox{and} \\quad j=1,2\\] \\[\\mbox{logit}(\\pi_{ij}) = \\beta_0 + \\beta_1*x_{ij} + u_i, \\quad u_i \\sim N(0,\\sigma_u^2)\\] where\n\n\\(\\pi_{ij}\\) is the probability of a favourable outcome in a patient on the \\(i\\)-th centre and \\(j\\)-th treatment\n\\(x_{ij}\\) is an indicator variable for treatment (0=control, 1=active drug)\n\\(u_i\\) is a random variable associated with the \\(i\\)-th centre\n\n\n\n4. Test if random effects are necessary.\n\n## Fit the models ##\nlibrary(lme4)\n\nM0 &lt;- glm(obs ~ 1 + treat, family=\"binomial\", weights=n, data=multicentre)\nM1 &lt;- glmer(obs ~ 1 + treat + (1|centre), family=\"binomial\", weights=n, data=multicentre)\n\n## LRT for the variance component sigma2_u ##\nLRT &lt;- -2*(logLik(M0)-logLik(M1))\nmean(1-pchisq(LRT,df=c(0,1)))\n\n[1] 3.885781e-15\n\n## We can also use the AIC/BIC to compare the models ##\ndata.frame(AIC=c(AIC(M0), AIC(M1)),\n           BIC=c(BIC(M0), BIC(M1)),\n           row.names=c(\"multicentre.glm\",\"multicentre.glmer\"))\n\n                       AIC      BIC\nmulticentre.glm   196.8286 199.0107\nmulticentre.glmer 138.4485 141.7216\n\n\n\n\n5. Check if the treatment effect is significant.\nWe compare nested models (with and without treat factor) using the LRT with the anova() function\n\nM1a &lt;- glmer(obs ~ 1 + (1|centre), family=\"binomial\", weights=n, data=multicentre)\nM1b &lt;- glmer(obs ~ 1 + treat + (1|centre), family=\"binomial\", weights=n, data=multicentre)\nanova(M1a,M1b)\n\nData: multicentre\nModels:\nM1a: obs ~ 1 + (1 | centre)\nM1b: obs ~ 1 + treat + (1 | centre)\n    npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)\nM1a    2 136.63 138.82 -66.317   132.63                     \nM1b    3 138.45 141.72 -66.224   132.45 0.1862  1     0.6661\n\n\nWe conclude that the treatment effect is not statistically significant.\n\n\n6. Using the model with fixed and random effects, which is the probability of a positive response on the active drug group? Interpret the odds ratio \\(e^{\\beta_1}\\) and compute a 95% confidence interval.\n\nlibrary(emmeans)\n\nWelcome to emmeans.\nCaution: You lose important information if you filter this package's results.\nSee '? untidy'\n\nemmeans(M1b, revpairwise~treat, type=\"response\", inf=TRUE)\n\n$emmeans\n treat    prob     SE  df asymp.LCL asymp.UCL null z.ratio p.value\n control 0.359 0.0892 Inf     0.208     0.545  0.5  -1.497  0.1345\n drug    0.376 0.0911 Inf     0.220     0.564  0.5  -1.301  0.1932\n\nConfidence level used: 0.95 \nIntervals are back-transformed from the logit scale \nTests are performed on the logit scale \n\n$contrasts\n contrast       odds.ratio    SE  df asymp.LCL asymp.UCL null z.ratio p.value\n drug / control       1.08 0.186 Inf     0.768      1.51    1   0.433  0.6651\n\nConfidence level used: 0.95 \nIntervals are back-transformed from the log odds ratio scale \nTests are performed on the log odds ratio scale \n\n\n\nFor \\(u_i=0\\), the probability of a positive response over a population of centres under the active drug group (\\(x_{ij}=1\\)) is \\(\\hat{\\pi}_{ij}=0.376\\) with a 95% confidence interval of \\([0.220, 0.564]\\).\nThe estimated odds of a patient showing a positive response on the active drug group relative to the control group is 1.08 with a 95% confidence interval of \\([0.77, 1.51]\\).\n\n\n\n7. Using the best model, verify whether the model assumptions on the random effects are satisfied.\n\nModel &lt;- M1a\n\nrand &lt;- unlist(ranef(Model)$centre)\nqqnorm(rand)\nqqline(rand)\n\n\n\nshapiro.test(rand)\n\n\n    Shapiro-Wilk normality test\n\ndata:  rand\nW = 0.93053, p-value = 0.4162\n\n\nWe don’t reject the null hypothesis of normality of the random effects.\n\n\n8. Which is the estimated variance and 95% confidence interval of the within-centre random effect? Compute and interpret the intra-class correlation coefficient.\n\nVarCorr(Model)\n\n Groups Name        Std.Dev.\n centre (Intercept) 1.1692  \n\nconfint(Model, parm=\"theta_\")\n\nComputing profile confidence intervals ...\n\n\n          2.5 %   97.5 %\n.sig01 0.709846 2.060211\n\n\nWe can compute the intra-class correlation coefficient as \\[\\rho=\\frac{\\sigma^2_u}{\\sigma^2_u+3.29}=1.169^2/(1.169^2+3.29) = 0.29347,\\] which means that 29% of the overall variability can be attributed to the differences between centres.\n\n\n9. Compute the predicted probabilties of a positive response for each value of the dataset. Include those estimated probabilities in the descriptive plot of section 1).\n\nmulticentre$pred &lt;- predict(Model, newdata=multicentre, type=\"response\")\nhead(multicentre)\n\n  centre   treat  y  n       obs      pred\n1      1    drug 11 36 0.3055556 0.3337400\n2      1 control 10 37 0.2702703 0.3337400\n3      2    drug 16 20 0.8000000 0.5178894\n4      2 control 22 32 0.6875000 0.5178894\n5      3    drug 14 19 0.7368421 0.4391549\n6      3 control  7 19 0.3684211 0.4391549\n\nggplot(multicentre, aes(x=obs, y=centre, color=treat)) +\n  geom_point() +\n  geom_point(aes(x=pred, y=centre), shape=8, color=\"black\") + \n  labs(x=\"Prob\", y=\"Centre\")\n\n\n\n\nObserved (dots) and predicted (asterisks) probabilities of a positive response for each centre\n\n\n\n\n\n\n\nExercise 2\nA Health Maintenance Organization wants to know what patient and physician factors are most related to whether a patient’s lung cancer goes into remission after treatment as part of a larger study of treatment outcomes and quality of life in patients with lung cancer.\nThe data has a multilevel structure where 8525 patients are nested within 407 doctors, who are in turn nested within 35 hospitals. The dataset contains either individual-level, doctor-level and hospital-level explanatory variables:\n\nremission: response variable (0=no, 1=yes)\nage: age of the patient (in years)\nIL6: Interleukin-6 concentration in blood (pg/ml)\nCRP: C-reactive protein concentration in blood (mg/dl)\nLengthofStay: duration of a patient’s hospital stay (in weeks)\nCancerStage: lung cancer stage (I, II, III or IV)\nSmoking: is the patient a smoker? (1=never, 2=former, 3=current)\nID.doctor: ID of the doctor\nID.hospital: ID of the hospital\n\n\n1. Load the data intored in the Patients.txt file. Convert ID.doctor and ID.hospital variables to factor.\n\npatients &lt;- read.table(file=\"patients.txt\", header=T, stringsAsFactors=T)\nhead(patients)\n\n  remission Age    IL6   CRP LengthofStay CancerStage Smoking ID.doctor\n1         0  65  3.699 8.086            6          II  former         1\n2         0  54  2.627 0.803            6          II  former         1\n3         0  53 13.896 4.034            5          II   never         1\n4         0  41  3.008 2.126            5           I  former         1\n5         0  47  3.891 1.349            6          II   never         1\n6         0  52  1.418 2.195            5           I   never         1\n  ID.hospital\n1           1\n2           1\n3           1\n4           1\n5           1\n6           1\n\npatients$ID.doctor &lt;- as.factor(patients$ID.doctor)\npatients$ID.hospital &lt;- as.factor(patients$ID.hospital)\npatients$Smoking &lt;- factor(patients$Smoking, levels=c(\"never\",\"former\",\"current\"))\nstr(patients)\n\n'data.frame':   8525 obs. of  9 variables:\n $ remission   : int  0 0 0 0 0 0 0 0 0 0 ...\n $ Age         : int  65 54 53 41 47 52 54 47 54 51 ...\n $ IL6         : num  3.7 2.63 13.9 3.01 3.89 ...\n $ CRP         : num  8.086 0.803 4.034 2.126 1.349 ...\n $ LengthofStay: int  6 6 5 5 6 5 4 5 6 7 ...\n $ CancerStage : Factor w/ 4 levels \"I\",\"II\",\"III\",..: 2 2 2 1 2 1 2 2 2 2 ...\n $ Smoking     : Factor w/ 3 levels \"never\",\"former\",..: 2 2 1 2 1 1 3 2 2 1 ...\n $ ID.doctor   : Factor w/ 407 levels \"1\",\"2\",\"3\",\"4\",..: 1 1 1 1 1 1 1 1 1 1 ...\n $ ID.hospital : Factor w/ 35 levels \"1\",\"2\",\"3\",\"4\",..: 1 1 1 1 1 1 1 1 1 1 ...\n\n\n\n\n2. Make some descriptive plots to visualize the relationship between variables.\n\nlibrary(ggplot2)\n\n## Explanatory continuous variables ##\nplot(patients[, c(\"Age\",\"IL6\",\"CRP\",\"LengthofStay\")])\n\n\n\n## Explanatory categorical variables ##\nggplot(patients, aes(x=CancerStage, y=LengthofStay)) +\n  stat_sum(aes(size=after_stat(n), group=1)) +\n  scale_size_area(max_size=10)\n\n\n\n## Response variable change over explanatory variables ##\ntmp &lt;- reshape2::melt(patients[, c(\"remission\", \"IL6\", \"CRP\")], id.vars=\"remission\")\nggplot(tmp, aes(factor(remission), y = value, fill=factor(remission))) +\n  geom_boxplot() +\n  facet_wrap(~variable, scales=\"free_y\")\n\n\n\nggplot(patients, aes(x=Age, y=remission, color=Smoking)) +\n  geom_point() +\n  stat_smooth(method=\"glm\", color=\"black\", se=FALSE,\n              method.args = list(family=binomial)) +\n  ggtitle(\"Lung cancer remission after treatment by age and cancer stage\") + \n  facet_wrap(~ CancerStage)\n\n\n\n\n\n\n3. Test if random effects are necessary.\n\n\n\n\n\n\n\n4. Hypothesis test for the fixed effects\n\n\n5. Fit the final logistic mixed model and write its equation. Compute intra-class correlation coefficient(s).\n\n\n\n6. Verify wether the model assumptions are satisfied\n\n\n7. Examine the model results\n\n\n8. Compute predicted probabilities of remission in lung for different patient characteristics attended by ID.doctor=2 in ID.hospital=1."
  }
]